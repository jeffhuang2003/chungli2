<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.chungli.mapper.UserProfileExtraMapper" >
  <resultMap id="BaseResultMap" type="com.chungli.dto.UserProfile" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sun Feb 14 01:19:06 CST 2016.
    -->
    <id column="UserId" property="userId" jdbcType="NVARCHAR" />
    <result column="ChineseName" property="chineseName" jdbcType="NVARCHAR" />
    <result column="Password" property="password" jdbcType="NVARCHAR" />
    <result column="Email" property="email" jdbcType="NVARCHAR" />
    <result column="Phone" property="phone" jdbcType="NVARCHAR" />
    <result column="Team" property="team" jdbcType="INTEGER" />
    <result column="LeaderEmail" property="leaderEmail" jdbcType="NVARCHAR" />
    <result column="CrDate" property="crDate" jdbcType="TIMESTAMP" />
    <result column="CrUser" property="crUser" jdbcType="NVARCHAR" />
    <result column="DateStamp" property="dateStamp" jdbcType="TIMESTAMP" />
    <result column="UserStamp" property="userStamp" jdbcType="NVARCHAR" />
    <result column="EnglishName" property="englishName" jdbcType="NVARCHAR" />
  </resultMap>
  
   <parameterMap type="java.util.Map" id="map">
    <parameter property="userId"/>
    <parameter property="startDate"/>
    <parameter property="endDate"/>
  </parameterMap>
  
   <select  id="selectUserProfileList" resultMap="BaseResultMap" parameterType="java.lang.String">
     		SELECT  UserId, ChineseName, Password, Email, Phone, Team, CrDate, CrUser, DateStamp, UserStamp, 
    				EnglishName , LeaderEmail
    		FROM UserProfile
     	    WHERE USERID in ( SELECT USERID FROM UserRefence 
							  WHERE  REFERRERID= #{userId}
							  OR USERID = #{userId}
							)
			order by USERID 
     </select>
     
     
        <select  id="selectUserProfileByLeader" resultMap="BaseResultMap" parameterType="java.lang.String">
     		SELECT  UserId, ChineseName, Password, Email, Phone, Team, CrDate, CrUser, DateStamp, UserStamp, 
    				EnglishName 
    		FROM UserProfile
     	    WHERE USERID in ( SELECT REFERRERID FROM UserRefence 
							  WHERE  USERID= #{userId}
							)
     </select>
     
     <select  id="selectUserProfileCount" resultType="java.lang.Integer" parameterType="java.lang.String">
     		SELECT  count(*) maxCount
    		FROM UserProfile
     	    WHERE USERID like #{userId}
     </select>
     
      <select  id="selectUserTeamProfileList" resultMap="BaseResultMap" parameterMap="map">
     		SELECT  UserId, ChineseName, Password, Email, Phone, Team, CrDate, CrUser, DateStamp, UserStamp, 
    				EnglishName 
    		FROM UserProfile
     	    WHERE USERID in ( SELECT USERID FROM UserRefence 
							  WHERE  REFERRERID= #{userId}
							  OR USERID = #{userId}
							)
			<if test="startDate != null">
			   and #{startDate} <![CDATA[<= ]]>     CONVERT(char(6), CrDate, 112) 
			</if>
			<if test="endDate != null">
			   and #{endDate} <![CDATA[ >= ]]>  CONVERT(char(6), CrDate, 112)  
			</if>
			order by USERID 
     </select>
  
</mapper>