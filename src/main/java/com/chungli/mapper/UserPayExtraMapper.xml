<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.chungli.mapper.UserPayExtraMapper">
  <resultMap id="BaseResultMap" type="com.chungli.dto.UserPay">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat May 07 16:32:04 CST 2016.
    -->
    <id column="InvoiceNumber" jdbcType="NVARCHAR" property="invoiceNumber" />
    <result column="UserId" jdbcType="NVARCHAR" property="userId" />
    <result column="EaID" jdbcType="NVARCHAR" property="eaId" />
    <result column="EaPayAmount" jdbcType="INTEGER" property="eaPayAmount" />
    <result column="StartTime" jdbcType="NVARCHAR" property="startTime" />
    <result column="EndTime" jdbcType="NVARCHAR" property="endTime" />
    <result column="CrDate" jdbcType="TIMESTAMP" property="crDate" />
    <result column="CrUser" jdbcType="NVARCHAR" property="crUser" />
    <result column="DateStamp" jdbcType="TIMESTAMP" property="dateStamp" />
    <result column="UserStamp" jdbcType="NVARCHAR" property="userStamp" />
  </resultMap>
     <parameterMap type="java.util.Map" id="map">
    <parameter property="userId" />
    <parameter property="endTime"/>
    <parameter property="eaId"/>
  </parameterMap>
  
  <select  id="selectMinUserPay" resultMap="BaseResultMap" parameterMap="map">
     SELECT InvoiceNumber , UserId ,EaID,EaPayAmount,StartTime,EndTime
  	 FROM UserPay
  	 WHERE UserId =#{userId}
  	 and EndTime = (SELECT Min(EndTime) EndTime
  	 				  FROM UserPay
  	 				  WHERE  EndTime   <![CDATA[ >= ]]>  #{endTime}
  	 				)
  </select>
  <select  id="selectMaxUserPay" resultMap="BaseResultMap" parameterMap="map">
     SELECT InvoiceNumber , UserId ,EaID,EaPayAmount,StartTime,EndTime
  	 FROM UserPay
  	 WHERE UserId =#{userId}
  	 and EndTime = (SELECT Max(EndTime) EndTime
  	 				  FROM UserPay
  	 				  WHERE  EndTime   <![CDATA[ >= ]]>  #{endTime}
     				   and eaId LIKE #{eaId}
  	 				)
 </select>
 </mapper>